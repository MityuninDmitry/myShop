# myShop v2
## Техническое задание
Приложение состоит из шести основных частей (модулей):
- страница витрины товаров, доступных для просмотра и покупки;
    - список товаров, доступных для заказа (картинка, название, цена, кнопка добавления в корзину/удаления из неё, кнопка изменения количества товара в корзине);
    - список товаров может быть представлен в любом виде (списком, плиткой);
    - есть пагинация (по 10, 20, 50, 100 товаров);
    - сверху строка поиска с фильтрацией по названию (можно просто по вхождению слова в название/описание товара);
    - сверху доступна фильтрация по цене, алфавиту
- страница товара;
    - название, картинка, описание товара, возможность положить товар в корзину/удалить его, изменить количество в корзине;
    - цена товара.
- страница корзины покупателя;
    - веб-страницу со списком положенных в неё товаров, их количеством, ценой каждого товара и общей ценой всей корзины;
    - есть возможность удалить товар из корзины, изменить его количество;
    - есть кнопка оформления заказа.
        - При нажатии на кнопку оформления заказа происходит эмуляция оформления заказа, при этом происходит переход на страницу оформленного заказа.
- страница всех заказов;
    - страницу со списком всех оформленных заказов, суммой каждого заказа и общей суммой всех заказов;
    - при нажатии на заказ появляется веб-страница совершённого заказа.
- страница заказа;
    - На веб-странице заказа представлен список купленных товаров (картинка, название, цена).
- сервис покупки (реализован в текущей версии).

## Основные эндпоинты
| Эндпоинт              | Описание                              | 
|-----------------------------------|---------------------------------------|
| http://localhost:8080             | Витрина товаров                       | 
| http://localhost:8080/order/basket | Корзина с товарами                    | 
| http://localhost:8080/order/orders | Оплаченные заказы                     |
| http://localhost:8080/order/{id}  | Открыть страницу с оплаченным заказом |
| http://localhost:8081/webjars/swagger-ui/index.html | Swagger UI платежного модуля|

## Особенности реализации
- Реализовано на реактивном стеке
- Корзина - это Order в статусе PRE_ORDER
- При оформлении заказа из корзины, корзина приобретает статус PAID (становится оплаченным заказом) и создается новая корзина
- Когда у товара стоит цифра 0, значит товара нет в корзине
- Кнопками + и - можно добавлять и убавлять товары в корзине соответственно
- На всех страницах есть плашка с кнопками (домой, корзина, оплаченные заказы)
- Для первичной загрузки товаров надо нажать ссылку ["Загрузить список товаров с нуля"](http://localhost:8080/createTestProducts) в левой верхней части страницы с [витриной товаров](http://localhost:8080)

## Алгоритм запуска приложения:
- Установить docker на компьютер
- Для клонирования проекта
```
git clone https://github.com/MityuninDmitry/myShop.git
```
- перейти в директорию проекта
```
cd myShop
```
- Запустить кейклок в контейнере выполнив команду
```
docker run -d -p 8180:8080 --name keycloak \
  -e KC_BOOTSTRAP_ADMIN_USERNAME=admin \
  -e KC_BOOTSTRAP_ADMIN_PASSWORD=admin \
  quay.io/keycloak/keycloak:26.1.3 start-dev
```
- Залогиниться под admin admin
- Загрузить json клиента webModule [webModule.json](files/webModule.json) (вкладка Clients - Import Client)
- У клиента webModule добавить роль WEB_APP
- Во вкладке Credentials скопировать секрет и вставить в CLIENT_SECRET=YOUR_VALUE в docker-compose.yml
- Запуск
      ```
      docker-compose up -d --build 
      ```
- Зайти под admin admin в веб приложение по ссылке (http://localhost:8080/login)
- Слева вверху добавить товары 
- Далее можно разлогиниться и зайти под user1 user1 или user2 user2
- Остановка
      ```
      docker-compose down
      ```
- Остановка с удалением
  ```
  docker-compose down -v
  ```

## Тесты:
- для прогона тестов веб модуля
```
./mvnw clean install -pl paymentModule
./mvnw clean test -pl webModule
```
!Внимание: тест иногда зависает, так и не смог до конца разобраться почему. Редис отваливается и к нему приложение повтрого не может запуститься. Помогает перезапуск тестов.
- для прогона тестов платежного модуля 
```./mvnw clean test -pl paymentModule```

## Используемые технологии

- Spring Boot
- Spring Security
- WebFlux
- Docker
- PostgreSQL
- Liquibase
- Thymeleaf
- HTML/CSS
- Maven
- Junit
- Redis
- Keycloak